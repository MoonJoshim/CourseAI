#!/usr/bin/env python3
"""ì¶”ê°€ ê°•ì˜í‰ ë°ì´í„°ë¥¼ Pineconeì— ì—…ë¡œë“œ"""

import os
from dotenv import load_dotenv
from pinecone import Pinecone
from sentence_transformers import SentenceTransformer
from datetime import datetime
import hashlib

load_dotenv()

pc = Pinecone(api_key=os.getenv('PINECONE_API_KEY'))
index = pc.Index(os.getenv('PINECONE_INDEX', 'courses-dev'))

print("ğŸ“¦ ì„ë² ë”© ëª¨ë¸ ë¡œë”© ì¤‘...")
model = SentenceTransformer('jhgan/ko-sroberta-multitask')

# ì¶”ê°€ ê°•ì˜í‰ ë°ì´í„°
additional_reviews = [
    # ì›¹ì‹œìŠ¤í…œì„¤ê³„ - ì˜¤ìƒìœ¤
    {'course_name': 'ì›¹ì‹œìŠ¤í…œì„¤ê³„', 'professor': 'ì˜¤ìƒìœ¤', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-2', 'rating': 4.0, 'text': 'ì›¹í”„ë¡ íŠ¸ë¶€í„° ë°±ì—”ë“œê¹Œì§€ ì „ì²´ì ìœ¼ë¡œ ë‹¤ë¤„ì£¼ì‹¬', 'year': 2024},
    {'course_name': 'ì›¹ì‹œìŠ¤í…œì„¤ê³„', 'professor': 'ì˜¤ìƒìœ¤', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-2', 'rating': 5.0, 'text': 'ê³¼ì œê°€ ì¢€ ê³¼ìƒí–ˆë˜ê²ƒ ë¹¼ë©´ ì•Œì°¼ì–´ìš” í”„ë¡œë¯¸ìŠ¤ì¸ê°€ ê·¸ê±´ ì¢€ ê·¸ë¬ìŒ ì „ë°˜ì ìœ¼ë¡œëŠ” í”„ë¡ íŠ¸ì—”ë“œ ì—­ëŸ‰ì„ í‚¤ìš°ê¸°ì— ì¢‹ì€ ê°•ì˜ì˜€ìŠµë‹ˆë‹¤', 'year': 2024},
    {'course_name': 'ì›¹ì‹œìŠ¤í…œì„¤ê³„', 'professor': 'ì˜¤ìƒìœ¤', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-2', 'rating': 5.0, 'text': 'ê°•ì˜ëŠ” ë”í•  ë‚˜ìœ„ì—†ê³  ì›¹ ì „ë°˜ì„ ë‹¤ë£¹ë‹ˆë‹¤ ê·¼ë° íŒ€í”Œì›ì„ 2ëŒ€ 2 ë§¤ì¹­ì„ í†µí•´ êµ¬ì„±í•˜ëŠ”ë° ì •ì‹ ë‚˜ê°„ ë…€ì„ë“¤ ë§Œë‚˜ë©´ ê°•ì¢Œ íŠ€ë§ˆë ¤ì›€', 'year': 2024},
    {'course_name': 'ì›¹ì‹œìŠ¤í…œì„¤ê³„', 'professor': 'ì˜¤ìƒìœ¤', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-2', 'rating': 5.0, 'text': 'ì›¹ì„ ì§„ë¡œë¡œ í•˜ê±°ë‚˜ í˜¹ì€ ì†Œì›¨ë¼ì„œ ì›¹ì„ í˜¼ìì„œ êµ¬ì¶•í•˜ëŠ” ëŠ¥ë ¥ì„ ê¸°ë¥´ê³  ì‹¶ë‹¤ë©´ ê¼­ ë“¤ìœ¼ì„¸ìš” html cssë¶€í„° nodejs ë¦¬ì•¡íŠ¸ ëª½ê³ ë””ë¹„ê¹Œì§€ ëª¨ë‘ ë‹¤ë£¨ë©° í”„ë¡œì íŠ¸ë¡œ í˜‘ì—… ê¸°íšŒê¹Œì§€ ì£¼ëŠ” ì›¹ ë°°ìš°ê¸°ì—ëŠ” ìµœê³ ì˜ ê°•ì˜ì…ë‹ˆë‹¤ êµìˆ˜ë‹˜ ê°•ì˜ë ¥ë„ í›Œë¥­í•˜ê³  ì„±ì ë„ ë„ˆê·¸ëŸ½ê²Œ ì£¼ì‹œëŠ”ê±° ê°™ìŠµë‹ˆë‹¤', 'year': 2024},
    {'course_name': 'ì›¹ì‹œìŠ¤í…œì„¤ê³„', 'professor': 'ì˜¤ìƒìœ¤', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-2', 'rating': 4.0, 'text': 'ì›¹ì— ëŒ€í•´ ì „ì²´ì ìœ¼ë¡œ í›‘ì„ ìˆ˜ ìˆë‹¤ íŒ€í”Œ ì‹œê°„ ë§ì´ ê±¸ë¦¼', 'year': 2024},
    {'course_name': 'ì›¹ì‹œìŠ¤í…œì„¤ê³„', 'professor': 'ì˜¤ìƒìœ¤', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-2', 'rating': 5.0, 'text': 'ì§„ë„ê°€ ë¹ ë¥´ì§€ë§Œ ê·¸ë§Œí¼ ê°•ì˜ë ¥ë„ ì¢‹ìœ¼ì‹œê³  í•™ìƒë“¤ ìƒê°í•˜ì‹œëŠ” ëª¨ìŠµì´ ë³´ì¸ë‹¤ ê³ ì¸ë¬¼íŒì´ë¼ê³  ë§í•˜ì§€ë§Œ ì²˜ìŒí•˜ë”ë¼ë„ ì—´ì‹¬íˆí•˜ë©´ ì¶©ë¶„íˆ ë”°ë¼ê°ˆ ìˆ˜ ìˆë‹¤ê³  ìƒê°', 'year': 2024},
    
    # í™•ë¥ ë°í†µê³„1 - ì¡°ì˜ì¢…
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 2.0, 'text': 'ë‚´ìš©ë„ ì–´ë µê³  êµìˆ˜ë‹˜ ê°•ì˜ ìŠ¤íƒ€ì¼ë„ ì–´ì©” ìˆ˜ ì—†ì´ ë“£ê¸´ í–ˆì–´ë„ ìƒìƒ ì´ìƒìœ¼ë¡œ í˜ë“¤ì—ˆë‹¤', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 2.0, 'text': 'ì´ë²ˆí•™ê¸°ê¹Œì§€ë§Œ í•˜ê³  í‡´ì§í•˜ì‹ ë‹¤ê³  í•˜ì…”ì„œ ì´ë²ˆí•™ê¸° ì—´ì‹¬íˆ ìˆ˜ê°•ì‹ ì²­í•œ ë‚´ê°€ ë°‰ë‹¤', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 2.0, 'text': 'í—˜ë‹´ì„ ì¢€ í•˜ì‹ ë‹¤ ëŒ€ì‹  ì‹œí—˜ì—ì„œ í•œë¬¸ì œë¼ë„ ë§ì¶”ë©´ ëŠ” ì•ˆë‚˜ì˜´', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 2.0, 'text': 'ë‚˜ëŠ” ì´ ìˆ˜ì—…ì„ ë“¤ìœ¼ëŸ¬ ê°ˆ ë•Œ ìì „ê±°ë¥¼ ì† ë†“ê³  íƒ„ë‹¤ ìˆ˜ì—… ì¥ì†Œì— ë„ì°©í•˜ê¸° ì „ì— ë‚´ê°€ ë’¤ì¡Œìœ¼ë©´ ì¢‹ê² ë‹¤', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 2.0, 'text': 'ì—°êµ¬ìë¡œì„œëŠ” ëŒ€ë‹¨í•œ ë¶„ì´ì§€ë§Œ ê°€ë¥´ì¹˜ëŠ” êµìˆ˜ë¡œì„œëŠ” ì‹¤ê²©ì¸ê±°ê°™ë‹¤ ì´ë²ˆì´ ë§ˆì§€ë§‰ìˆ˜ì—…ì´ì‹œë„¤ìš” ê±´ê°•í•˜ì„¸ìš”', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 2.0, 'text': 'ì–´ëŠ ì¥ë‹¨ì— ë§ì¶°ì„œ ê³µë¶€í•´ì•¼í• ì§€ ëª¨ë¥´ê² ë‹¤ ë°©í–¥ì„±ì´ ì—†ëŠ”ë“¯', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 2.0, 'text': 'ë§ì´ ë°°ìš¸ ìˆ˜ ìˆìœ¼ë‚˜ ê·¸ë§Œí¼ í˜ë“¬ êµìˆ˜ì„±ê²©ì€ ë¤', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 3.0, 'text': 'ê³¼ì œëŠ” ìƒë‹¹íˆ í•˜ê¸° ì‰¬ìš°ë‚˜ ìˆ˜ì—…ì´ ì–´ë ¤ì›€ ì¢€ ë” ì—´ì‹¬íˆ ê³µë¶€í•´ì•¼ ì¢‹ì€ ì„±ì  ë°›ì„ ê±° ê°™ë„¤ìš”', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 4.0, 'text': 'ì„±ê²© ì•ˆ ë§ëŠ” ë¶„ë„ ìˆê² ì§€ë§Œ ì €ëŠ” ì¢‹ì•˜ê³  ìœ ìµí•œ ìˆ˜ì—…ì…ë‹ˆë‹¤ ê³µë¶€ ì—´ì‹¬íˆ ì•ˆ í• ê±°ë©´ ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 2.0, 'text': 'í˜¼ì ê³µë¶€í•´ì„œ ë”°ë¼ê°€ì•¼ë˜ê³  êµìˆ˜ë‹˜ì´ ì •ì¹˜ ì–˜ê¸° ë“±ì„ í•˜ì‹­ë‹ˆë‹¤ ë¹„ì¶”ì…ë‹ˆë‹¤', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 5.0, 'text': 'ì„±ì  ë¹„ìœ¨ëŒ€ë¡œ ê½‰ ì±„ì›Œì£¼ì‹œê³  ì‹œí—˜ ë°˜íƒ€ì‘ë§Œ í•´ë„ ì—ì´ì¸ë°ë‹¤ê°€ êµì¬ í’€ì´ ê·¸ëŒ€ë¡œ ë‚˜ì˜¤ëŠ”ë° ê¹ê¹í•˜ë‹¤ê³  í‰ê°€í•œ ì‚¬ëŒë“¤ì€ ë­”ì§€ ëª¨ë¥´ê² ìŒ êµìˆ˜ë‹˜ì´ ê°€ë” ë…ì„¤í•˜ì‹œëŠ” ê±´ ë§ì§€ë§Œ ì¸ê²©ëª¨ë… í•˜ëŠ” ê²ƒë„ ì•„ë‹ˆê³ ', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 1.0, 'text': 'ë¯¸ì¹œ êµìˆ˜ ì¬ìˆ˜ê°•í•˜ì§€ ì•Šìœ¼ë ¤ê³  ì—´ì‹¬íˆ ë“¤ì—ˆìŒ', 'year': 2024},
    {'course_name': 'í™•ë¥ ë°í†µê³„1', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2024-1', 'rating': 1.0, 'text': 'ì¼ë‹¨ ë³¸ì¸ ì˜ˆì¡¸ ìˆ˜ì—… ì•ˆë“¤ì—ˆìŒ ëª‡ë²ˆ ë“¤ì–´ë„ ì–»ì–´ê°€ëŠ”ê±° ì—†ê³  ê·¸ëƒ¥ í˜¼ì ê³µë¶€í•˜ëŠ”ê²Œ í•™ì  ë°›ê¸° í›¨ ë‚˜ìŒ êµìˆ˜ë‹˜ ìë‘ ëŒ€ì”ì¹˜ ë“£ê¸° ì‹«ìœ¼ë©´ ê·¸ëƒ¥ ìˆ˜ì—…ì‹œê°„ì— ëª°ë˜ ë¬¸ì œë‚˜ í’ˆ', 'year': 2024},
    
    # ì»´í“¨í„°í†µì‹  - ì¡°ì˜ì¢…
    {'course_name': 'ì»´í“¨í„°í†µì‹ ', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2023-2', 'rating': 4.0, 'text': 'ì•„ì£¼ëŒ€ì˜ ì•¤ë“œë¥˜ í…Œì´íŠ¸ ì•„ë‹ê¹Œ ê³µë¶€ ì™¸ì—ë„ ë°°ìš¸ê²Œ ì—„ì²­ ë§ì•˜ë‹¤ ê·¸ëŸ°ë° í†µì‹  í• ê±° ì•„ë‹ˆë©´ ë¹„ì¶” ë¬¼ë¡  ì €ë„ ì•ˆí•©ë‹ˆë‹¤', 'year': 2023},
    {'course_name': 'ì»´í“¨í„°í†µì‹ ', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2023-2', 'rating': 5.0, 'text': 'ê°•ì˜ ìì²´ëŠ” ìƒë‹¹íˆ ìœ ìµí•˜ë‹¤ í†µì‹ ì— ëŒ€í•´ ë§¤ìš° ê¹Šê²Œ ì•Œë ¤ì£¼ì‹œë©° í˜„ëŒ€ì— í†µì‹ ì´ ë“¤ì–´ê°€ì§€ ì•ŠëŠ” ê³³ì€ ì—†ë‹¤ë³´ë‹ˆ ì •ë§ ë¡œìš°í•œ ì§€ì‹ë“¤ì„ ì–»ê¸°ì— ì¢‹ë‹¤ ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¨ìˆœí•œ í•™ì ê´€ë¦¬ ì‹œí—˜ê³µë¶€ê°€ ì•„ë‹Œ ì§„ì§œ ê³µë¶€ë¡œ ì„±ê³µí•˜ê¸° ìœ„í•´ í•´ì•¼ í•˜ëŠ” ì¤‘ìš”í•œ ê²ƒë“¤ì„ ë§ì´ ì•Œë ¤ì£¼ì‹ ë‹¤ ì¡°ê¸ˆ ê¼°ëŒ€ê°™ì´ ëŠê»´ì§ˆ ìˆ˜ ìˆì§€ë§Œ ê·¸ ì‹œëŒ€ë¥¼ ì‚´ì•„ì˜¨ ì‹¬ì§€ì–´ í›Œë¥­í•œ ì—˜ë¦¬íŠ¸ë¡œ ì‚´ì•„ì˜¤ì‹  ë¶„ì˜ ëª©ì†Œë¦¬ì´ë‹ˆ ê·¸ë§Œí•œ ê°€ì¹˜ê°€ ìˆê³  ì¢‹ì€ ì†Œë¦¬ì„ì—ëŠ” í‹€ë¦¼ì—†ë‹¤', 'year': 2023},
    {'course_name': 'ì»´í“¨í„°í†µì‹ ', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2023-2', 'rating': 3.0, 'text': 'ìˆ˜ì—… ì „ì— êµì¬ë¥¼ ì½ìœ¼ë©´ì„œ ì˜ˆìŠµí•˜ëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤ ë˜í•œ êµì¬ ì—°ìŠµë¬¸ì œë¥¼ í‘¸ëŠ” ê³¼ì œê°€ ë§¤ì£¼ ë‚˜ê°€ëŠ”ë° ì´ë¥¼ í‘¸ì‹œê³  ì˜ ì •ë¦¬í•´ ë‘ì‹œê¸¸ ë°”ëë‹ˆë‹¤', 'year': 2023},
    {'course_name': 'ì»´í“¨í„°í†µì‹ ', 'professor': 'ì¡°ì˜ì¢…', 'department': 'ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼', 'semester': '2023-2', 'rating': 3.0, 'text': 'ë…¼ë€ì˜ ì—¬ì§€ê°€ ìˆëŠ” ë°œì–¸ì„ ë§ì´ í•˜ì‹œì§€ë§Œ ê·¸ëƒ¥ ì•„ë¬´ ìƒê° ì—†ì´ í•„ìš”í•œ ë¶€ë¶„ë§Œ ê³¨ë¼ ë“¤ìœ¼ë©´ ë¨ ì›ë˜ë„ ë”±ë”±í•œ ê³¼ëª©ì´ê³  êµì¬ê°€ ì¢€ ì˜¤ë˜ëœ ê±°ë¼ ê³¼ì œ ì •ë‹µ ì°¾ê¸°ë„ ì–´ë ¤ìš¸ ê²ƒì„ ì»´ë„¤ ì•ˆ ë“¤ì—ˆê±°ë‚˜ ì»´ë„¤ ë“¤ì–´ë„ í†µì‹ ì— í° í¥ë¯¸ê°€ ì—†ê±°ë‚˜ ì»´ë„¤ ì´í•´ ì•ˆ ê°”ìœ¼ë©´ ì´ ê³¼ëª©ì€ ë¹„ì¶”', 'year': 2023},
]

print(f"ğŸ“¤ {len(additional_reviews)}ê°œì˜ ê°•ì˜í‰ì„ Pineconeì— ì—…ë¡œë“œí•©ë‹ˆë‹¤...\n")

# ë²¡í„° ìƒì„± ë° ì—…ë¡œë“œ
vectors = []
for i, review in enumerate(additional_reviews):
    # ì„ë² ë”© ìƒì„±
    text = review['text']
    embedding = model.encode(text).tolist()
    
    # ASCII ì „ìš© Vector ID ìƒì„± (í•´ì‹œ ì‚¬ìš©)
    unique_string = f"{review['course_name']}_{review['professor']}_{review['semester']}_{i}_{text[:50]}"
    hash_id = hashlib.md5(unique_string.encode()).hexdigest()[:16]
    vector_id = f"review_{hash_id}"
    
    # ë©”íƒ€ë°ì´í„°
    metadata = {
        'course_name': review['course_name'],
        'professor': review['professor'],
        'department': review['department'],
        'semester': review['semester'],
        'year': float(review['year']),
        'rating': float(review['rating']),
        'text': review['text'],
        'source': 'manual',
        'uploaded_at': datetime.now().isoformat()
    }
    
    vectors.append({
        'id': vector_id,
        'values': embedding,
        'metadata': metadata
    })
    
    print(f"âœ… {i+1}/{len(additional_reviews)}: {review['course_name']} - {review['professor']} (í‰ì  {review['rating']})")

# Pineconeì— ì—…ë¡œë“œ
print(f"\nğŸ“¤ Pinecone ì—…ë¡œë“œ ì¤‘...")
index.upsert(vectors=vectors)
print(f"âœ… ì—…ë¡œë“œ ì™„ë£Œ!\n")

# í†µê³„ í™•ì¸
stats = index.describe_index_stats()
print(f"ğŸ“Š ì—…ë°ì´íŠ¸ëœ Pinecone í†µê³„:")
print(f"  - ì´ ë²¡í„° ìˆ˜: {stats.total_vector_count}")
print(f"  - ì°¨ì›: {stats.dimension}")
